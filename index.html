<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>áƒ˜áƒœáƒ¢áƒ”áƒ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ áƒ£áƒ™áƒ + Markdown áƒáƒáƒœáƒ”áƒšáƒ˜</title>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Marked: Markdown â†’ HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- (áƒáƒ áƒáƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒ) áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ£áƒšáƒ˜ Markdown-áƒ¨áƒ˜ áƒ‘áƒ›áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒáƒ®áƒáƒš áƒ©áƒáƒœáƒáƒ áƒ—áƒ¨áƒ˜ áƒ’áƒáƒ®áƒ¡áƒœáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ -->
  <base target="_blank">
  <style>
    :root{
      --panel-w: 420px;
      --bg: #0b1220;
      --card: #111a2b;
      --acc: #86aefb;
      --text: #e6eefc;
    }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    #app { height: 100%; width: 100%; display: grid; grid-template-columns: 1fr; }
    #map { height: 100%; width: 100%; }

    /* áƒªáƒáƒ áƒ¯áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜ */
    #panel {
      position: fixed; top: 0; right: 0; height: 100%; width: var(--panel-w);
      background: var(--card); border-left: 1px solid #23314f; box-shadow: -8px 0 24px rgba(0,0,0,.35);
      transform: translateX(100%); transition: transform .28s ease;
      display: flex; flex-direction: column; z-index: 9999; overflow: hidden;
    }
    #panel.open { transform: translateX(0); }
    #panel header { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border-bottom: 1px solid #213150; }
    #panel header h3 { margin: 0; font-size: 16px; font-weight: 600; }
    #panel header button { background: transparent; color: var(--text); border: 1px solid #31466d; border-radius: 10px; padding: 6px 10px; cursor: pointer; }
    #panel header button:hover { background: #1a2741; }
    #panel-body { padding: 14px; overflow: auto; }
    #panel-body :is(h1,h2,h3) { color: #cbd9ff; }
    #panel-body pre { background: #0b162c; padding: 10px; border-radius: 10px; overflow: auto; }
    #panel-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

    .leaflet-container { background: #0a0f1d; }
    .leaflet-popup-content-wrapper { background: var(--card); color: var(--text); border: 1px solid #31466d; }
    .leaflet-popup-tip { background: var(--card); border: 1px solid #31466d; }

    .btn { display:inline-block; padding: 6px 10px; border: 1px solid #3a5590; color: white; border-radius: 10px; text-decoration: none; cursor: pointer; user-select: none; }
    .btn:hover { background: #1b2b50; }
    .btn-primary { background: #1a2a4e; }

    .brand { position: absolute; left: 12px; top: 12px; z-index: 500; background: #0d172b; border: 1px solid #22355f; border-radius: 12px; padding: 8px 10px; font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.25); }
  </style>
</head>
<body>
  <div id="app">
    <div id="map"></div>
    <div class="brand">ğŸŒ áƒ©áƒ”áƒ›áƒ˜ áƒ¡áƒáƒ˜áƒœáƒ¢áƒ”áƒ áƒ”áƒ¡áƒ áƒ¬áƒ”áƒ áƒ¢áƒ˜áƒšáƒ”áƒ‘áƒ˜</div>
  </div>

  <!-- áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ—áƒ˜ Markdown áƒáƒáƒœáƒ”áƒšáƒ˜ -->
  <aside id="panel" aria-hidden="true">
    <header>
      <h3 id="panel-title">áƒ“áƒáƒ™áƒ£áƒ›áƒ”áƒœáƒ¢áƒ˜</h3>
      <div>
        <button id="open-md-raw" class="btn" title="áƒ’áƒáƒ®áƒ¡áƒœáƒ áƒ¬áƒ§áƒáƒ áƒ áƒ‘áƒ›áƒ£áƒšáƒ˜áƒ—">Raw</button>
        <button id="panel-close" class="btn">áƒ“áƒáƒ®áƒ£áƒ áƒ•áƒ</button>
      </div>
    </header>
    <div id="panel-body">
      <p style="opacity:.8">áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ áƒ£áƒ™áƒáƒ–áƒ” áƒ¬áƒ”áƒ áƒ¢áƒ˜áƒšáƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” <em>â€œáƒ™áƒ˜áƒ—áƒ®áƒ•áƒâ€</em> áƒ¦áƒ˜áƒšáƒáƒ™áƒ¡ â€” áƒ¨áƒ”áƒ¡áƒáƒ‘áƒáƒ›áƒ˜áƒ¡áƒ˜ Markdown áƒ¤áƒáƒ˜áƒšáƒ˜ áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ áƒáƒ¥.</p>
    </div>
  </aside>

  <script>
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // áƒ áƒ£áƒ™áƒ
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    const map = L.map('map', { zoomControl: true }).setView([41.72, 44.78], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // áƒ“áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”: Markdown áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ GitHub Raw/áƒ¡áƒ®áƒ•áƒ URL-áƒ˜áƒ“áƒáƒœ
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    const panel = document.getElementById('panel');
    const panelTitle = document.getElementById('panel-title');
    const panelBody  = document.getElementById('panel-body');
    const openRawBtn = document.getElementById('open-md-raw');
    const closeBtn   = document.getElementById('panel-close');

    closeBtn.addEventListener('click', () => panel.classList.remove('open'));

    async function loadMarkdown({ url, title }) {
      if (!url) {
        panelTitle.textContent = title || 'áƒ“áƒáƒ™áƒ£áƒ›áƒ”áƒœáƒ¢áƒ˜';
        panelBody.innerHTML = '<p style="opacity:.8">áƒáƒ› áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ—áƒáƒœ Markdown áƒ‘áƒ›áƒ£áƒšáƒ˜ áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒ áƒáƒ.</p>';
        panel.classList.add('open');
        return;
      }
      try {
        panelTitle.textContent = title || 'áƒ“áƒáƒ™áƒ£áƒ›áƒ”áƒœáƒ¢áƒ˜';
        panelBody.innerHTML = '<p>áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ...</p>';
        const res = await fetch(url, { cache: 'no-cache' });
        const text = await res.text();
        panelBody.innerHTML = marked.parse(text);
        openRawBtn.onclick = () => window.open(url, '_blank');
        panel.classList.add('open');
      } catch (err) {
        panelBody.innerHTML = `<p style="color:#ffb3b3">áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ Markdown: ${err}</p>`;
        panel.classList.add('open');
      }
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // GeoJSON áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ â€” áƒ¯áƒ”áƒ  áƒ•áƒªáƒ“áƒ˜áƒšáƒáƒ‘áƒ— external áƒ¤áƒáƒ˜áƒšáƒ¡, áƒ—áƒ£ áƒ•áƒ”áƒ áƒ â€” áƒ•áƒáƒ áƒ“áƒ”áƒ‘áƒ˜áƒ— demo áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ–áƒ”
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    const externalGeoJsonUrl = 'data/points.geojson'; // áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜ /data/points.geojson áƒ¨áƒ”áƒœáƒ¡ áƒ áƒ”áƒáƒáƒ¨áƒ˜

    // Popup HTML áƒ’áƒ”áƒœáƒ”áƒ áƒáƒ¢áƒáƒ áƒ˜
    function popupHtml(props){
      const title = props.title || 'áƒ£áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜';
      const descr = props.description || '';
      const mdUrl = props.md || props.mdPath || '';
      const btn   = `<button class="btn btn-primary" onclick="loadMarkdown({url: '${mdUrl}', title: '${title.replace(/'/g, "&#39;")}'})">áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ</button>`;
      const more  = props.link ? `<a class="btn" href="${props.link}">áƒ‘áƒ›áƒ£áƒšáƒ˜</a>` : '';
      return `<div style="min-width:220px"><div style="font-weight:700;margin-bottom:6px">${title}</div><div style="opacity:.9;margin-bottom:8px">${descr}</div><div style="display:flex; gap:8px; flex-wrap:wrap">${btn}${more}</div></div>`;
    }

    function addGeoJsonLayer(geojson){
      return L.geoJSON(geojson, {
        pointToLayer: (feature, latlng) => L.marker(latlng),
        onEachFeature: (feature, layer) => {
          layer.bindPopup(popupHtml(feature.properties || {}));
        }
      }).addTo(map);
    }

    (async function init(){
      try {
        const res = await fetch(externalGeoJsonUrl, { cache: 'no-cache' });
        if (!res.ok) throw new Error('no external geojson');
        const gj = await res.json();
        addGeoJsonLayer(gj);
      } catch(e){
        console.warn('External GeoJSON áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ, áƒ•áƒ®áƒ›áƒáƒ áƒáƒ‘áƒ— demo áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ¡');
        addGeoJsonLayer(DEMO_GEOJSON);
      }
    })();

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // Demo áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ â€” áƒ©áƒáƒáƒœáƒáƒªáƒ•áƒšáƒ” áƒ¨áƒ”áƒœáƒ˜áƒ—, áƒáƒœ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜ data/points.geojson áƒ˜áƒ’áƒ˜áƒ•áƒ” áƒ¡áƒ¥áƒ”áƒ›áƒ˜áƒ—
    // md áƒ•áƒ”áƒšáƒ˜ áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒ” RAW GitHub áƒ‘áƒ›áƒ£áƒšáƒ˜áƒ—, áƒ›áƒáƒ’: https://raw.githubusercontent.com/<user>/<repo>/<branch>/content/tbilisi.md
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    const DEMO_GEOJSON = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "title": "áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜áƒ¡ áƒ¢áƒ”áƒšáƒ”áƒáƒœáƒ«áƒ",
            "description": "áƒ¡áƒáƒ˜áƒœáƒ¢áƒ”áƒ áƒ”áƒ¡áƒ áƒ®áƒ”áƒ“áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ¥áƒáƒšáƒáƒ¥áƒ˜áƒ¡ áƒáƒáƒœáƒáƒ áƒáƒ›áƒ.",
            "md": "content/sample.md",
            "link": "https://ka.wikipedia.org/wiki/%E1%83%97%E1%83%94%E1%83%9A%E1%83%94%E1%83%90%E1%83%9C%E1%83%AB%E1%83%90_(%E1%83%97%E1%83%91%E1%83%98%E1%83%9A%E1%83%98%E1%83%A1%E1%83%98)"
          },
          "geometry": { "type": "Point", "coordinates": [44.7879, 41.7096] }
        },
        {
          "type": "Feature",
          "properties": {
            "title": "áƒ‘áƒáƒ—áƒ£áƒ›áƒ˜áƒ¡ áƒ‘áƒ£áƒšáƒ•áƒáƒ áƒ˜",
            "description": "áƒ¨áƒáƒ•áƒ˜ áƒ–áƒ¦áƒ•áƒ˜áƒ¡ áƒ¡áƒáƒœáƒáƒáƒ˜áƒ áƒ áƒ“áƒ áƒáƒáƒšáƒ›áƒ”áƒ‘áƒ˜.",
            "md": "content/sample.md"
          },
          "geometry": { "type": "Point", "coordinates": [41.6339, 41.6469] }
        }
      ]
    };
  </script>
</body>
</html>
